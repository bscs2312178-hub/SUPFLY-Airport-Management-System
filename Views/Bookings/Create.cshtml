@model SUPFLY.Models.Booking

@{
    ViewData["Title"] = "Confirm Booking";
}

<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div class="card shadow border-0">
                <div class="card-header bg-primary text-white text-center py-3">
                    <h3 class="mb-0"><i class="bi bi-airplane-engines"></i> Complete Your Booking</h3>
                    @if (Model.IsRoundTrip)
                    {
                        <span class="badge bg-info text-dark mt-2">Round-Trip Ticket</span>
                    }
                </div>
                <div class="card-body p-4">
                    <form asp-action="Create">
                        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                        @* --- HIDDEN LOGIC FIELDS --- *@
                        <input type="hidden" asp-for="FlightId" />
                        <input type="hidden" asp-for="ReturnFlightId" />
                        <input type="hidden" asp-for="IsRoundTrip" />
                        <input type="hidden" name="PassengerId" value="@ViewBag.PassengerId" />
                        <input type="hidden" asp-for="PassengerId" />
                        <input type="hidden" asp-for="PricePaid" />
                        <input type="hidden" asp-for="BookingDate" value="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm:ss")" />
                        <input type="hidden" asp-for="Status" value="Confirmed" />

                        @* --- TRIP INFO DISPLAY --- *@
                        <div class="alert alert-light border mb-4">
                            <h6 class="text-muted text-uppercase small">Passenger</h6>
                            <p class="h5 mb-0"><i class="bi bi-person-circle"></i> @User.Identity.Name</p>
                        </div>

                        @* --- SEAT SELECTION --- *@
                        <div class="row">
                            @* Outbound Seat *@
                            <div class="@(Model.IsRoundTrip ? "col-md-6" : "col-md-12") mb-3">
                                <label asp-for="SeatNumber" class="control-label fw-bold">
                                    <i class="bi bi-grid-3x3-gap"></i> @(Model.IsRoundTrip ? "Outbound Seat" : "Seat Number")
                                </label>
                                <input asp-for="SeatNumber" class="form-control form-control-lg" placeholder="e.g. 12A" required />
                                <span asp-validation-for="SeatNumber" class="text-danger small"></span>
                            </div>

                            @* Return Seat (Only shows if it's a Round Trip) *@
                            @if (Model.IsRoundTrip)
                            {
                                <div class="col-md-6 mb-3">
                                    <label asp-for="ReturnSeatNumber" class="control-label fw-bold text-info">
                                        <i class="bi bi-grid-3x3-gap"></i> Return Seat
                                    </label>
                                    <input asp-for="ReturnSeatNumber" class="form-control form-control-lg border-info" placeholder="e.g. 14C" required />
                                    <span asp-validation-for="ReturnSeatNumber" class="text-danger small"></span>
                                </div>
                            }
                        </div>

                        <div class="bg-light p-3 rounded mb-4 d-flex justify-content-between align-items-center">
                            <span class="fw-bold">Total Price:</span>
                            <span class="h4 mb-0 text-success fw-bold">@Model.PricePaid.ToString("C")</span>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-success btn-lg shadow-sm">
                                <i class="bi bi-check-circle"></i> Confirm and Book
                            </button>
                            <a asp-controller="Flights" asp-action="Search" class="btn btn-link text-muted text-center">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}